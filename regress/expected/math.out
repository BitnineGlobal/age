/*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */
LOAD 'age';
SET search_path TO ag_catalog;
SELECT create_graph('math_test');
NOTICE:  graph "math_test" has been created
 create_graph 
--------------
 
(1 row)

-- Factorial function tests age_fact()
-- 0! = 1
SELECT * FROM age_fact(0);
  age_fact  
------------
 1::numeric
(1 row)

-- 1! = 1
SELECT * FROM age_fact(1);
  age_fact  
------------
 1::numeric
(1 row)

-- 5! = 120
SELECT * FROM age_fact(5);
   age_fact   
--------------
 120::numeric
(1 row)

-- 10! = 3628800
SELECT * FROM age_fact(100);
                                                                                age_fact                                                                                 
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 93326215443944152681699238856266700490715968264381621468592963895217599993229915608941463976156518286253697920827223758251185210916864000000000000000000000000::numeric
(1 row)

-- 20! = 2432902008176640000
SELECT * FROM age_fact(500);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         age_fact                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 1220136825991110068701238785423046926253574342803192842192413588385845373153881997605496447502203281863013616477148203584163378722078177200480785205159329285477907571939330603772960859086270429174547882424912726344305670173270769461062802310452644218878789465754777149863494367781037644274033827365397471386477878495438489595537537990423241061271326984327745715546309977202781014561081188373709531016356324432987029563896628911658974769572087926928871281780070265174507768410719624390394322536422605234945850129918571501248706961568141625359056693423813008856249246891564126775654481886506593847951775360894005745238940335798476363944905313062323749066445048824665075946735862074637925184200459369692981022263971952597190945217823331756934581508552332820762820023402626907898342451712006207714640979456116127629145951237229913340169552363850942885592018727433795173014586357570828355780158735432768888680120399882384702151467605445407663535984174430480128938313896881639487469658817504506926365338175055478128640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000::numeric
(1 row)

-- Overflow test
SELECT * FROM age_fact(32178);
ERROR:  value overflows numeric format
-- Inside the cypher query
-- At CREATE clause
SELECT * FROM cypher('math_test', $$
CREATE (n:Node {value: fact(5)})
RETURN n.value
$$) AS (value agtype);
    value     
--------------
 120::numeric
(1 row)

-- At MATCH clause
SELECT * FROM cypher('math_test', $$
MATCH (n:Node {value: fact(5)})
RETURN n.value
$$) AS (value agtype);
    value     
--------------
 120::numeric
(1 row)

-- At RETURN clause
SELECT * FROM cypher('math_test', $$
MATCH (n:Node {value: fact(5)})
RETURN fact(toInteger(n.value))
$$) AS (value agtype);
                                                                                                      value                                                                                                       
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 6689502913449127057588118054090372586752746333138029810295671352301633557244962989366874165271984981308157637893214090552534408589408121859898481114389650005964960521256960000000000000000000000000000::numeric
(1 row)

-- At WHERE clause
SELECT * FROM cypher('math_test', $$
MATCH (n:Node)
WHERE n.value = fact(5)
RETURN n.value
$$) AS (value agtype);
    value     
--------------
 120::numeric
(1 row)

-- At SET clause
SELECT * FROM cypher('math_test', $$
MATCH (n:Node)
SET n.value = fact(3)
RETURN n.value
$$) AS (value agtype);
   value    
------------
 6::numeric
(1 row)

-- CLEANUP
SELECT * FROM drop_graph('math_test', true);
NOTICE:  drop cascades to 3 other objects
DETAIL:  drop cascades to table math_test._ag_label_vertex
drop cascades to table math_test._ag_label_edge
drop cascades to table math_test."Node"
NOTICE:  graph "math_test" has been dropped
 drop_graph 
------------
 
(1 row)

-- End of math.sql
